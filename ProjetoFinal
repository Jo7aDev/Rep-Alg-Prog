#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#define MAX_PRODUTOS 100
#define MAX_MARCAS 50

typedef struct {
  char descricao[100];
  float peso;
  float valorCompra;
  float valorVenda;
  float lucro;
  float percentualLucro;
  char fabricante[50];
  char estado[3];
} Produto;

typedef struct {
  char nome[50];
  char site[100];
  char telefone[15];
  char uf[3];
} Fabricante;

Produto produtos[MAX_PRODUTOS];
int numProdutos = 0;

Fabricante fabricantes[MAX_MARCAS];
int numFabricantes = 0;

void limparTela() {
#ifdef _WIN32
    system("cls");
#else
    system("clear");
#endif
}

void aguardarEnter() {
    printf("\nPressione ENTER para continuar...");
    while (getchar() != '\n');
}

void adicionarProduto() {
  limparTela();

  Produto novoProduto;

  printf("Digite a descricao do produto: ");
  fgets(novoProduto.descricao, 100, stdin);
  printf("Digite o peso do produto: ");
  scanf("%f", &novoProduto.peso);
  printf("Digite o valor de compra do produto: ");
  scanf("%f", &novoProduto.valorCompra);
  printf("Digite o valor de venda do produto: ");
  scanf("%f", &novoProduto.valorVenda);
  getchar();

  printf("Digite a marca do produto: ");
  fgets(novoProduto.fabricante, 50, stdin);
  novoProduto.fabricante[strcspn(novoProduto.fabricante, "\n")] =
      '\0';

  printf("Digite o estado do produto: ");
  fgets(novoProduto.estado, 3, stdin);
  novoProduto.estado[strcspn(novoProduto.estado, "\n")] = '\0';

  novoProduto.lucro = novoProduto.valorVenda - novoProduto.valorCompra;
  novoProduto.percentualLucro =
      (novoProduto.lucro / novoProduto.valorCompra) * 100;

  produtos[numProdutos] = novoProduto;
  numProdutos++;

  printf("\nProduto adicionado com sucesso!\n");
  aguardarEnter();
}

void adicionarFabricante() {
  limparTela();

  Fabricante novoFabricante;

  printf("Digite o nome da marca: ");
  fgets(novoFabricante.nome, 50, stdin);
  printf("Digite o site da marca: ");
  fgets(novoFabricante.site, 100, stdin);
  printf("Digite o telefone da marca: ");
  fgets(novoFabricante.telefone, 15, stdin);
  printf("Digite o UF da marca: ");
  fgets(novoFabricante.uf, 3, stdin);

  fabricantes[numFabricantes] = novoFabricante;
  numFabricantes++;

  printf("\nFabricante adicionado com sucesso!\n");
  aguardarEnter();
}

void listarMarcas() {
  limparTela();

  printf("==============================================================\n");
  printf("Marcas cadastradas:\n");
  printf("==============================================================\n\n");
	int i;
	for (i = 0; i < numFabricantes; i++) {
    printf("%s\n", fabricantes[i].nome);
  }

  aguardarEnter();
}

void listarProdutos() {
  limparTela();

  printf("==============================================================\n");
  printf("Produtos cadastrados:\n");
  printf("==============================================================\n\n");
  int i;
  for (i = 0; i < numProdutos; i++) {
    printf("Descricao: %s", produtos[i].descricao);
    printf("Peso: %.2f\n", produtos[i].peso);
    printf("Valor de compra: R$ %.2f\n", produtos[i].valorCompra);
    printf("Valor de venda: R$ %.2f\n", produtos[i].valorVenda);
    printf("Lucro: R$ %.2f\n", produtos[i].lucro);
    printf("Percentual de lucro: %.2f%%\n", produtos[i].percentualLucro);
    printf("Marca: %s\n", produtos[i].fabricante);
    printf("Estado: %s\n", produtos[i].estado);
    printf("--------------------------------------------------------------\n");
  }

  aguardarEnter();
}

void listarProdutosEstado(char estado[]) {
  limparTela();

  printf("==============================================================\n");
  printf("Produtos do estado %s:\n", estado);
  printf("==============================================================\n\n");
  int i;
  int encontrou = 0;
  for (i = 0; i < numProdutos; i++) {
    if (strcmp(produtos[i].estado, estado) == 0) {
      printf("Descricao: %s", produtos[i].descricao);
      printf("Peso: %.2f\n", produtos[i].peso);
      printf("Valor de compra: R$ %.2f\n", produtos[i].valorCompra);
      printf("Valor de venda: R$ %.2f\n", produtos[i].valorVenda);
      printf("Lucro: R$ %.2f\n", produtos[i].lucro);
      printf("Percentual de lucro: %.2f%%\n", produtos[i].percentualLucro);
      printf("Marca: %s\n", produtos[i].fabricante);
      printf("Estado: %s\n", produtos[i].estado);
      printf("--------------------------------------------------------------\n");
      encontrou = 1;
    }
  }

  if (!encontrou) {
    printf("Nenhum produto encontrado no estado %s.\n", estado);
  }

  aguardarEnter();
}

void listarProdutosMarca(char marca[]) {
  limparTela();

  printf("==============================================================\n");
  printf("Produtos da marca %s:\n", marca);
  printf("==============================================================\n\n");
  int i;
  int encontrou = 0;
  for (i = 0; i < numProdutos; i++) {
    if (strcmp(produtos[i].fabricante, marca) == 0) {
      printf("Descricao: %s", produtos[i].descricao);
      printf("Peso: %.2f\n", produtos[i].peso);
      printf("Valor de compra: R$ %.2f\n", produtos[i].valorCompra);
      printf("Valor de venda: R$ %.2f\n", produtos[i].valorVenda);
      printf("Lucro: R$ %.2f\n", produtos[i].lucro);
      printf("Percentual de lucro: %.2f%%\n", produtos[i].percentualLucro);
      printf("Marca: %s\n", produtos[i].fabricante);
      printf("Estado: %s\n", produtos[i].estado);
      printf("--------------------------------------------------------------\n");
      encontrou = 1;
    }
  }

  if (!encontrou) {
    printf("Nenhum produto encontrado da marca %s.\n", marca);
  }

  aguardarEnter();
}

void encontrarProdutoMaisCaro() {
  limparTela();

  float maiorValor = 0;
  char estadoMaisCaro[3];

  int i;
  for (i = 0; i < numProdutos; i++) {
    if (produtos[i].valorVenda > maiorValor) {
      maiorValor = produtos[i].valorVenda;
      strcpy(estadoMaisCaro, produtos[i].estado);
    }
  }

  printf("==============================================================\n");
  printf("Produto mais caro:\n");
  printf("==============================================================\n\n");
  printf("Valor: R$ %.2f\n", maiorValor);
  printf("Estado: %s\n", estadoMaisCaro);

  aguardarEnter();
}

void encontrarProdutoMaisBarato() {
  limparTela();

  float menorValor = produtos[0].valorCompra;
  char fabricantesMaisBaratos[MAX_MARCAS][50];
  int numFabricantesMaisBaratos = 0;

  int i;
  for (i = 0; i < numProdutos; i++) {
    if (produtos[i].valorCompra < menorValor) {
      menorValor = produtos[i].valorCompra;
      numFabricantesMaisBaratos = 0;
      strcpy(fabricantesMaisBaratos[numFabricantesMaisBaratos], produtos[i].fabricante);
      numFabricantesMaisBaratos++;
    } else if (produtos[i].valorCompra == menorValor) {
      strcpy(fabricantesMaisBaratos[numFabricantesMaisBaratos], produtos[i].fabricante);
      numFabricantesMaisBaratos++;
    }
  }

  printf("==============================================================\n");
  printf("Produto(s) mais barato(s):\n");
  printf("==============================================================\n\n");
  printf("Valor: R$ %.2f\n", menorValor);
  printf("Fabricante(s):");
  int j;
  for (j = 0; j < numFabricantesMaisBaratos; j++) {
    printf("%s\n", fabricantesMaisBaratos[j]);
  }

  aguardarEnter();
}

void ordenarProdutosPorValor() {
  limparTela();

  Produto temp;

  int i, j;
  for (i = 0; i < numProdutos - 1; i++) {
    for (j = 0; j < numProdutos - i - 1; j++) {
      if (produtos[j].valorVenda > produtos[j + 1].valorVenda) {
        temp = produtos[j];
        produtos[j] = produtos[j + 1];
        produtos[j + 1] = temp;
      }
    }
  }

  printf("==============================================================\n");
  printf("Produtos em ordem crescente de valor:\n");
  printf("==============================================================\n\n");
  for (i = 0; i < numProdutos; i++) {
    printf("Descricao: %s", produtos[i].descricao);
    printf("Peso: %.2f\n", produtos[i].peso);
    printf("Valor de compra: R$ %.2f\n", produtos[i].valorCompra);
    printf("Valor de venda: R$ %.2f\n", produtos[i].valorVenda);
    printf("Lucro: R$ %.2f\n", produtos[i].lucro);
    printf("Percentual de lucro: %.2f%%\n", produtos[i].percentualLucro);
    printf("Marca: %s\n", produtos[i].fabricante);
    printf("Estado: %s\n", produtos[i].estado);
    printf("--------------------------------------------------------------\n");
  }

  aguardarEnter();
}

void ordenarProdutosPorLucro() {
  limparTela();

  Produto temp;

  int i, j;
  for (i = 0; i < numProdutos - 1; i++) {
    for (j = 0; j < numProdutos - i - 1; j++) {
      if (produtos[j].lucro > produtos[j + 1].lucro) {
        temp = produtos[j];
        produtos[j] = produtos[j + 1];
        produtos[j + 1] = temp;
      }
    }
  }

  printf("==============================================================\n");
  printf("Produtos em ordem crescente de maior valor de lucro:\n");
  printf("==============================================================\n\n");
  for (i = 0; i < numProdutos; i++) {
    printf("Descricao: %s", produtos[i].descricao);
    printf("Peso: %.2f\n", produtos[i].peso);
    printf("Valor de compra: R$ %.2f\n", produtos[i].valorCompra);
    printf("Valor de venda: R$ %.2f\n", produtos[i].valorVenda);
    printf("Lucro: R$ %.2f\n", produtos[i].lucro);
    printf("Percentual de lucro: %.2f%%\n", produtos[i].percentualLucro);
    printf("Marca: %s\n", produtos[i].fabricante);
    printf("Estado: %s\n", produtos[i].estado);
    printf("--------------------------------------------------------------\n");
  }

  aguardarEnter();
}

int main() {
  int opcao;
  do {
    limparTela();

    printf("Bem vindo ao menu! Escolha uma das opcoes a seguir:\n\n");
    printf("1. Adicionar produto\n");
    printf("2. Adicionar marca\n");
    printf("3. Listar marcas\n");
    printf("4. Listar produtos\n");
    printf("5. Listar produtos de um determinado estado\n");
    printf("6. Listar produtos de uma determinada marca\n");
    printf("7. Apresentar o(s) estado(s) onde esta registrado o produto mais caro\n");
    printf("8. Apresentar o(s) fabricante(s) onde esta registrado o produto mais barato\n");
    printf("9. Listar todos os produtos em ordem crescente de valor\n");
    printf("10. Listar todos os produtos em ordem crescente de maior valor do lucro\n");
    printf("0. Sair\n");
    printf("\nDigite sua opcao: ");
    scanf("%d", &opcao);
    getchar();

    switch (opcao) {
      case 1:
        adicionarProduto();
        break;
      case 2:
        adicionarFabricante();
        break;
      case 3:
        listarMarcas();
        break;
      case 4:
        listarProdutos();
        break;
      case 5: {
        char estado[3];
        printf("Digite o estado: ");
        fgets(estado, 3, stdin);
        estado[strcspn(estado, "\n")] = '\0';
        listarProdutosEstado(estado);
        break;
      }
      case 6: {
        char marca[50];
        printf("Digite a marca: ");
        fgets(marca, 50, stdin);
        marca[strcspn(marca, "\n")] = '\0';
        listarProdutosMarca(marca);
        break;
      }
      case 7:
        encontrarProdutoMaisCaro();
        break;
      case 8:
        encontrarProdutoMaisBarato();
        break;
      case 9:
        ordenarProdutosPorValor();
        break;
      case 10:
        ordenarProdutosPorLucro();
        break;
      case 0:
        printf("Saindo...\n");
        break;
      default:
        printf("Opcao invalida! Tente novamente.\n");
        aguardarEnter();
    }
  } while (opcao != 0);

  return 0;
}
